<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Transliteration ukrainischer Ausweisdokumente</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@3.4.69/build/css/index.css">
        <style>
            .simple-keyboard {
                width: 50%;
                margin: 0px auto;
            }
        </style>
    </head>
    <body>
        <input name="input" class="input" id="input"><br>
        <input name="output" id="output">
        <div class="simple-keyboard">

        </div>
    </body>
    <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@3.4.69/build/index.js"></script>
    <script>
        (function () {
            'use strict';

            const translit_table = {1072: 'a', 1073: 'b', 1074: 'v', 1075: 'g', 1169: 'g', 1076: 'd', 1077: 'e', 1108: 'ie', 1078: 'zh', 1079: 'z', 1080: 'y', 1110: 'i', 1111: 'i', 1081: 'i', 1082: 'k', 1083: 'l', 1084: 'm', 1085: 'n', 1086: 'o', 1087: 'p', 1088: 'r', 1089: 's', 1090: 't', 1091: 'u', 1092: 'f', 1093: 'kh', 1094: 'ts', 1095: 'ch', 1096: 'sh', 1097: 'shch', 1100: '', 1102: 'iu', 1103: 'ia', 1040: 'A', 1041: 'B', 1042: 'V', 1043: 'G', 1168: 'G', 1044: 'D', 1045: 'E', 1028: 'Ie', 1046: 'Zh', 1047: 'Z', 1048: 'Y', 1030: 'I', 1031: 'I', 1049: 'I', 1050: 'K', 1051: 'L', 1052: 'M', 1053: 'N', 1054: 'O', 1055: 'P', 1056: 'R', 1057: 'S', 1058: 'T', 1059: 'U', 1060: 'F', 1061: 'Kh', 1062: 'Ts', 1063: 'Ch', 1064: 'Sh', 1065: 'Shch', 1068: '', 1070: 'Iu', 1071: 'Ia'};

            let i;
            let inputString;
            let outputString;

            let inputField = document.getElementById('input');
            let outputField = document.getElementById('output');

            document.addEventListener('DOMContentLoaded', initialize);

            const ukrainian={default:[" й ц у к е н г ш щ з х ї ґ {bksp}"," ф і в а п р о л д ж є ","{shift} я ч с м и т ь б ю {shift}","{space}"],shift:[" Й Ц У К Е Н Г Ш Щ З Х Ї Ґ {bksp}"," Ф І В А П Р О Л Д Ж Є ","{shift} Я Ч С М И Т Ь Б Ю {shift}","{space}"]};

            function transliterate() {
                inputString = inputField.value;
                console.log(inputString);
                outputString = "";
                for (i = 0; i < inputString.length; i++) {
                    if (inputString.charCodeAt(i) in translit_table) {
                        outputString += translit_table[inputString.charCodeAt(i)]
                    } else {
                        outputString += inputString.charAt(i);
                    }
                }
                console.log(outputString);
                outputField.value = outputString;
            }

            function initScreenKeyboard() {
                const Keyboard = window.SimpleKeyboard.default;

                const myKeyboard = new Keyboard({
                    onChange: input => onChange(input),
                    onKeyPress: input => onKeyPress(input),
                    layout: ukrainian,
                    display: {
                        '{bksp}': 'Löschen',
                        '{shift}': 'Shift',
                        '{space}': 'Leertaste'
                    }
                });

                function onChange(input) {
                    inputField.value += input;
                    myKeyboard.clearInput();
                    transliterate();
                }

                function onKeyPress(button) {
                    /**
                     * If you want to handle the shift and caps lock buttons
                     */
                    if (button === "{shift}") handleShift();
                }
                function handleShift() {
                    let currentLayout = myKeyboard.options.layoutName;
                    let shiftToggle = currentLayout === "default" ? "shift" : "default";
                  
                    myKeyboard.setOptions({
                      layoutName: shiftToggle
                    });
                  }
            }

            function initialize() {
                inputField.addEventListener('input', () => transliterate());
                initScreenKeyboard();               
                console.log('Initialized');
            }
        })();
    </script>
</html>
